# Websocket API for LaFabriqueDuCollectif.exe
version 0.5

Description of the messages exchanged between the Websocket server running on Unity application *LaFabriqueDuCollectif.exe*
and Android smartphones connected to the same WiFi network

In the folowing section :  
- *IP* is the IP address of the computer on the network  
- *Port* is the Websocket port set in Unity Editor (7777 by default)  
- *ProjectName* is the name of the project open in LaFabriqueDuCollectif.exe
- *SessionKey* is a random code of 4 characters generated by the server and available on the Unity Application interface.

## Services

### Ping
Allow to ping the server to check it is still alive

URI : `ws://IP:Port/SessionKey

Text message expected : **None**

Response to text message : **None**

Response to ping : **"Pong"**


### Floors
Request the floors names, levels and image from the projet

URI : `ws://IP:Port/SessionKey/floors`

Text message expected : **None**

Response to text message : **JSON formatted as this**
```json
{
  "Floors":[
    {
        "Name": (string) "FloorName_0",
        "Id": (int - unique) Id_0,
        "Image": (string) "FloorImageData_0 (as PNG Base64 string)"
    },
        {
        "Name": (string) "FloorName_1",
        "Id": (int - unique) Id_1,
        "Image": (string) "FloorImageData_1 (as PNG Base64 string)"
    }
    ...
  ]
}
```

Response to ping : **Same as response to text message**


### Notes
Send a note to the project

URI : `ws://IP:Port/SessionKey/note`

Text message expected : **JSON formatted as this**
```json
{
    "Title": (string) "the title review",
    "Content": (string) "the content review",
    "Emotion": {
        "Valence": (float) [-1 -> 1],
        "Intensity": (float) [-1 -> 1]
    },
    "Location": {
        "XCoordinate": (float) [0 -> 1],
        "YCoordinate": (float) [0 -> 1],
        "Id": (int - unique) Id
    },
    "Image": (string) "NoteImageData (as JPG Base64 string)",
    "Author": (string) "Author of the review",
    "Date": (string) "Date of creation",
    "Tags": (string) "tags separated with commas (optional)",
    "Session": (string) "Session key code"
}
```

*Note : Location X and Y are given relatively to the floor image, origin is image top left corner*  
*Note 2 : The image must be a JPG encodes as Base64 string*

Response to text message : 
- **INCORRECT_NOTE_FORMAT** : the message doesn't start with `{` or ends with `}` or one of the following keys is missing in the json "NoteMessage", "Emotion" , "Location", "NoteData"
- **JSON_PARSING_ERROR** : The server could not parse the json data
- **TEXTURE_CONVERSION_ERROR** : NoteImageData is not a valid JPG Base64 string
- **SAVE_DATA_ERROR** : The server could not create or save the image file or metadata file on its end
- **UNKNOWN_FLOOR_ID** : The 'Location Id' field has a value that doesn't exist in the floor list
- **ERROR** : Unidentified error - see logs on server side for more information
- **OK** : Note created and files saved

Response to ping : **NONE**